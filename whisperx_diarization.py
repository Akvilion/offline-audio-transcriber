#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
üéôÔ∏è [–ü–õ–ê–ù] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π (WhisperX —á–µ—Ä–µ–∑ Docker) üéôÔ∏è

–≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—é
(—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—á–∏ –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º) —Å –ø–æ–º–æ—â—å—é WhisperX.

–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä—è–º–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ WhisperX –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ Python-–æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç
–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –æ—Å–æ–±–µ–Ω–Ω–æ —Å –Ω–æ–≤—ã–º–∏ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞–º–∏ NVIDIA.
–ü–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö**, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è
–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–º –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º —Ä–µ—à–µ–Ω–∏–µ–º.

-----------------------------------------------------------------------
                          –ü–û–ß–ï–ú–£ DOCKER?
-----------------------------------------------------------------------

–ü—Ä–æ–±–ª–µ–º–∞:
WhisperX —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PyTorch, torchaudio),
–∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ NVIDIA –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏
–ø–∞–∫–µ—Ç–∞–º–∏ –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ. –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è "dependency hell".

–†–µ—à–µ–Ω–∏–µ:
NVIDIA –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—á–µ—Ä–µ–∑ NGC –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ),
–≤ –∫–æ—Ç–æ—Ä—ã—Ö —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ: CUDA, PyTorch –∏ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
–≠—Ç–æ –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç
—Ä–∞–±–æ—Ç–∞—Ç—å "–∏–∑ –∫–æ—Ä–æ–±–∫–∏". –ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å WhisperX.

-----------------------------------------------------------------------
                          –ü–õ–ê–ù–ò–†–£–ï–ú–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ
-----------------------------------------------------------------------

- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —Å –ø–æ–º–æ—â—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ Whisper.
- –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤ –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏.
- **–î–∏–∞—Ä–∏–∑–∞—Ü–∏—è —Å–ø–∏–∫–µ—Ä–æ–≤** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö .txt, .srt, .json —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π —Å–ø–∏–∫–µ—Ä–æ–≤
  (–Ω–∞–ø—Ä–∏–º–µ—Ä, "[SPEAKER_01]: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!").

-----------------------------------------------------------------------
                          –ü–û–†–Ø–î–û–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø (–ü–õ–ê–ù)
-----------------------------------------------------------------------

–ü—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ NVIDIA Container Toolkit.**
    –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à—É GPU.

2.  **–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ç–æ–≤–æ–≥–æ Docker-–æ–±—Ä–∞–∑–∞ —Å WhisperX:**
    ```bash
    docker pull ghcr.io/jim60105/whisperx
    ```

3.  **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ:**
    –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç (`whisperx_diarization.py`) –≤ –±—É–¥—É—â–µ–º —Å—Ç–∞–Ω–µ—Ç –æ–±—ë—Ä—Ç–∫–æ–π,
    –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é—â–µ–π –∑–∞–ø—É—Å–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞—à–∏—Ö —Ñ–∞–π–ª–æ–≤.
    –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º":

    ```bash
    # –¢–æ–∫–µ–Ω Hugging Face –Ω—É–∂–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏
    export HF_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–¥–æ—Å—Ç—É–ø–∞

    docker run --gpus all --rm \
      -e HF_TOKEN=$HF_TOKEN \
      -v /–ø—É—Ç—å/–∫/–≤–∞—à–∏–º/–∞—É–¥–∏–æ:/app/audio \
      -v /–ø—É—Ç—å/–∫/—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º:/app/results \
      ghcr.io/jim60105/whisperx \
      --audio /app/audio/meeting.mp3 \
      --output_dir /app/results \
      --diarize \
      --model large-v3
    ```

–ê–≤—Ç–æ—Ä: –ú–∏—Ö–∞–∏–ª –®–∞—Ä–¥–∏–Ω https://shardin.name/
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 30.08.2025
–í–µ—Ä—Å–∏—è: 0.2-alpha (–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Docker)

–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å: https://github.com/empenoso/offline-audio-transcriber
"""

#
# –í –±—É–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç
# –∫–æ–º–∞–Ω–¥—É `docker run` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (–ø—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º, –º–æ–¥–µ–ª—å –∏ —Ç.–¥.).
#
# import subprocess
# import sys
# ...
#

def main():
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —Å–∫—Ä–∏–ø—Ç–∞."""
    print("======================================================================")
    print("üéôÔ∏è –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π (–ü–ª–∞–Ω: WhisperX + Docker)")
    print("======================================================================")
    print("\n‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —è–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–æ—Ç–æ–≤–∫–æ–π –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.")
    print("\n–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏,")
    print("—á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å GPU NVIDIA.")
    print("\n–ü—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:")
    print("  1. –í—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–∞–ø–∫–∏ –∞—É–¥–∏–æ.")
    print("  2. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å WhisperX.")
    print("  3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π –ø–æ —Å–ø–∏–∫–µ—Ä–∞–º —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–ø–∫—É.")
    print("\n–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!")
    print("[—Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π]")
    print()

if __name__ == "__main__":
    main()